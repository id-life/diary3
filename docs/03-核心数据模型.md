# 核心数据模型

所有核心数据类型定义在 `src/entry/types-constants.ts` 文件中。

## EntryType - 习惯类型

**用途**：定义一个习惯/任务的基本信息

```typescript
interface EntryType {
  id: string;           // 唯一标识符（通常是英文习惯名）
  title: string;        // 显示名称
  defaultPoints: number; // 默认积分（完成一次获得的分数）
  pointStep: number;    // 积分步长（调整积分时的增减量）
  routine: RoutineEnum; // 重复周期
  createdAt: number;    // 创建时间戳
  updatedAt: number;    // 更新时间戳
  themeColors: string[]; // 主题颜色数组（渐变色）
}
```

### RoutineEnum - 重复周期枚举

```typescript
enum RoutineEnum {
  daily = 'Daily',    // 每日
  weekly = 'Weekly',  // 每周
  monthly = 'Monthly', // 每月
  adhoc = 'Adhoc',    // 不定期
}
```

### EntryType 示例

```json
{
  "id": "exercise",
  "title": "运动",
  "defaultPoints": 10,
  "pointStep": 5,
  "routine": "Daily",
  "createdAt": 1704067200000,
  "updatedAt": 1704067200000,
  "themeColors": ["FF5912", "FC3650"]
}
```

### EntryTypeConstructor - 构造函数

```typescript
const EntryTypeConstructor = ({
  id = '',
  title = '',
  defaultPoints = 0,
  pointStep = 0,
  routine = RoutineEnum.adhoc,
  themeColors = ['#000000'],
}) => EntryType
```

---

## EntryInstance - 条目实例

**用途**：记录某个习惯的单次完成情况

```typescript
interface EntryInstance {
  id: string;          // 唯一标识符（格式：{entryTypeId}-{ISO时间}-{随机数}）
  entryTypeId: string; // 关联的 EntryType ID
  createdAt: number;   // 创建时间戳（决定条目属于哪一天）
  updatedAt: number;   // 更新时间戳
  points: number;      // 本次获得的积分
  notes: string;       // 备注
}
```

### EntryInstance 示例

```json
{
  "id": "exercise-2024-01-15T10:30:00.000Z-42",
  "entryTypeId": "exercise",
  "createdAt": 1705315800000,
  "updatedAt": 1705315800000,
  "points": 10,
  "notes": "跑步 5 公里"
}
```

### ID 生成规则

```typescript
const getEntryInstanceIdFromEntryType = (entryType: EntryType, date = dayjs()) => {
  return `${entryType.id}-${date.toISOString()}-${Math.floor(Math.random() * 120)}`;
};
```

---

## ReminderRecord - 提醒记录

**用途**：设置习惯提醒

```typescript
type ReminderRecord = {
  id: string;
  title: string;
  content?: string;
  type: ReminderType;
  weekDay?: number;      // 周几（0-6），用于 Weekly 类型
  monthDay?: number;     // 几号（1-31），用于 Monthly 类型
  month?: number;        // 几月（0-11），用于 Annual 类型
  sinceStartTime?: number; // 开始时间，用于 Since 类型
  isSendReminderEmail?: boolean;
  createdAt: number;
  updatedAt: number;
};
```

### ReminderType - 提醒类型枚举

```typescript
enum ReminderType {
  weekly = 'Weekly',   // 每周
  monthly = 'Monthly', // 每月
  annual = 'Annual',   // 每年
  since = 'Since',     // 从某日起
}
```

---

## DiaryDate - 日期类型

**用途**：表示日记中的日期

```typescript
type Year = number;
type Month = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12;
type Day = 1 | 2 | ... | 31;

interface DiaryDate {
  year: Year;
  month: Month;  // 1-12（注意：不是 0-11）
  day: Day;      // 1-31
}
```

---

## StreakStatus - 连续记录状态

**用途**：表示习惯在某个周期内的完成状态

```typescript
enum StreakStatus {
  UNCREATED = 'uncreated',     // 习惯尚未创建
  INCOMPLETE = 'incomplete',   // 未完成
  COMPLETED = 'completed',     // 已完成
  WARNING = 'warning',         // 警告（快要失败）
}
```

---

## 数据存储结构

### localStorage 键名映射

| 键名 | 数据类型 | 说明 |
|------|----------|------|
| `entryTypes.entryTypesArray` | `EntryType[]` | 习惯类型列表 |
| `entryInstances.entryInstancesMap` | `{ [dateStr]: EntryInstance[] }` | 条目实例按日期分组 |
| `reminderRecords.reminderRecords` | `ReminderRecord[]` | 提醒记录列表 |
| `auth_token` | `string` | OAuth 访问令牌 |

### entryInstancesMap 结构

条目实例按日期字符串分组存储：

```typescript
type EntryInstancesMap = {
  [dateString: string]: EntryInstance[];
  // 例如: "2024-01-15": [instance1, instance2]
}
```

日期字符串格式：`YYYY-MM-DD`

---

## 主题颜色预设

项目预定义了 24 组渐变色供习惯类型选择：

```typescript
const EntryTypeThemeColors = [
  ['FF5912', 'FC3650'],  // 红橙
  ['FC8D3C', 'FF5912'],  // 橙红
  ['FCA53C', 'FF8812'],  // 橙黄
  ['FFCF26', 'F9A709'],  // 黄橙
  ['89D365', '09BDA0'],  // 绿青
  ['09BDA0', '3E90FF'],  // 青蓝
  ['3592FF', '6865FF'],  // 蓝紫
  ['6865FF', '9E3EEF'],  // 紫粉
  // ... 更多颜色组合
];
```

---

## 日期工具函数

### 时间戳转日期字符串

```typescript
// 获取日期字符串（YYYY-MM-DD）
getDateStringFromTimestamp(timestamp: number): string

// 获取当前日期字符串
getDateStringFromNow(): string

// 获取日期时间字符串（YYYY-MM-DD-hh-mm-ss）
getDatetimeStringFromTimestamp(timestamp: number): string
```

### 获取周期日期范围

```typescript
// 获取指定周期类型的日期范围数组
getDatePeriods(type: RoutineEnum, cycle = 7): Array<{start: string, end: string}>
```

---

## 数据验证要点

1. **EntryType.id** 必须唯一且非空
2. **EntryInstance.entryTypeId** 必须对应存在的 EntryType
3. **createdAt/updatedAt** 必须是有效的时间戳（毫秒）
4. **points** 应为非负数
5. **themeColors** 应为有效的 HEX 颜色值（不含 #）
