# 目录结构详解

## 完整目录树

```
diary3/
├── src/
│   ├── app/                          # Next.js App Router 页面
│   │   ├── layout.tsx               # 根布局（全局样式、Provider、导航栏）
│   │   ├── login/                   # 登录页
│   │   │   └── page.tsx
│   │   └── (protected)/             # 受保护的路由组（需认证）
│   │       ├── layout.tsx           # 认证守卫包装
│   │       ├── page.tsx             # 首页（重定向到 /entry）
│   │       ├── entry/               # 日记条目页
│   │       │   └── page.tsx
│   │       ├── add/                 # 添加/编辑习惯页
│   │       │   └── page.tsx
│   │       ├── reminder/            # 提醒管理页
│   │       │   ├── page.tsx
│   │       │   └── add/
│   │       │       └── page.tsx
│   │       └── settings/            # 设置页
│   │           └── page.tsx
│   │
│   ├── atoms/                        # Jotai 状态管理
│   │   ├── index.ts                 # 导出所有原子和 jotaiStore
│   │   ├── app.ts                   # 全局应用状态
│   │   ├── user.ts                  # GitHub OAuth 用户状态
│   │   ├── entryTypes.ts            # 习惯类型数据 + CRUD
│   │   ├── entryInstances.ts        # 条目实例数据 + CRUD
│   │   ├── reminderRecords.ts       # 提醒记录 + CRUD
│   │   ├── uiState.ts              # 页面 UI 状态
│   │   ├── chart.ts                # 图表相关计算原子
│   │   └── databaseFirst.ts         # 混合型原子（localStorage 同步）
│   │
│   ├── components/                   # React 组件
│   │   ├── app/                     # 应用级组件
│   │   │   ├── Theme.tsx            # 主题切换
│   │   │   └── BackupDialog.tsx     # 备份对话框
│   │   ├── auth/                    # 认证相关
│   │   │   ├── AuthGuard.tsx        # 认证防护包装
│   │   │   └── UserProfilePage.tsx
│   │   ├── entry/                   # 日记条目相关（核心）
│   │   │   ├── EntryPageContent.tsx       # 主页面内容
│   │   │   ├── EntryHeader.tsx
│   │   │   ├── EntryChart.tsx             # 图表展示
│   │   │   ├── EntryProgressBar.tsx       # 进度条
│   │   │   ├── EntryInstanceList.tsx      # 条目列表
│   │   │   ├── EntryInstanceForm.tsx      # 条目表单
│   │   │   ├── EntryTypeCard.tsx
│   │   │   ├── EntryTypeForm.tsx          # 习惯编辑表单
│   │   │   ├── EntryTypeCompletionForm.tsx
│   │   │   ├── EntryTypeListForCompletion.tsx
│   │   │   ├── EntryStreakCard.tsx
│   │   │   └── StreaksContainer.tsx
│   │   ├── reminder/                # 提醒相关
│   │   │   ├── ReminderRecords.tsx
│   │   │   ├── ReminderRecordCard.tsx
│   │   │   └── ReminderAddForm.tsx
│   │   ├── dialog/                  # 对话框
│   │   │   ├── index.tsx
│   │   │   ├── AddDialog.tsx
│   │   │   └── DialogComponents.tsx
│   │   ├── data/                    # 数据导出
│   │   │   └── DataExportDialog.tsx
│   │   ├── layout/                  # 布局组件
│   │   │   └── Navbar.tsx           # 底部导航栏
│   │   ├── ui/                      # Shadcn UI 组件库
│   │   │   ├── button.tsx
│   │   │   ├── input.tsx
│   │   │   ├── card.tsx
│   │   │   ├── form.tsx
│   │   │   └── ...
│   │   └── common/                  # 通用组件
│   │       ├── ClientOnly.tsx       # 仅客户端渲染
│   │       ├── ErrorBoundary.tsx
│   │       └── ProviderComposer.tsx
│   │
│   ├── api/                          # API 请求层
│   │   ├── request.ts              # Axios 实例配置
│   │   ├── auth.ts                 # 认证 API
│   │   ├── github.ts               # GitHub 备份 API
│   │   └── type.ts                 # API 响应类型
│   │
│   ├── hooks/                        # 自定义 React Hooks
│   │   ├── app.ts                  # 全局应用 hooks
│   │   ├── useGitHubOAuth.ts       # GitHub OAuth 登录
│   │   ├── useDataExport.ts        # 数据导出
│   │   ├── useInput.ts             # 输入框处理
│   │   ├── useDebounce.ts
│   │   ├── useThrottle.ts
│   │   ├── useJotaiMigration.ts    # Jotai 迁移工具
│   │   └── entryType.ts            # 习惯类型相关
│   │
│   ├── utils/                        # 工具函数
│   │   ├── index.ts                # 导出 cn()、safeNumberValue()
│   │   ├── date.ts                 # 日期工具函数
│   │   ├── entry.ts                # 条目相关计算（连续记录等）
│   │   ├── localStorageExport.ts  # localStorage 导出
│   │   ├── backupDataConverter.ts # 备份数据转换
│   │   ├── stateMigration.ts      # 状态迁移
│   │   ├── GithubStorage.ts       # GitHub 存储接口
│   │   └── notification.ts        # 通知工具
│   │
│   ├── entry/                        # 数据模型和常量
│   │   ├── types-constants.ts      # 核心数据类型定义
│   │   └── sample-state.json       # 样本数据
│   │
│   ├── providers/                    # React 提供者
│   │   ├── root.tsx                # 根提供者（Jotai + React Query）
│   │   └── jotai-provider.tsx      # Jotai 存储提供者
│   │
│   ├── styles/                       # 样式
│   │   ├── globals.css             # 全局样式
│   │   ├── theme.css               # 主题定义
│   │   └── fonts.ts                # 字体导入
│   │
│   └── constants/                    # 常量
│       ├── env.ts                  # 环境变量
│       └── storage.ts              # 存储键常量
│
├── public/                           # 静态资源
│   ├── favicon.ico
│   ├── manifest.json
│   └── svgs/
│
├── docs/                             # 项目文档
│
└── 配置文件
    ├── package.json                # 依赖和脚本
    ├── tsconfig.json               # TypeScript 配置
    ├── next.config.mjs             # Next.js 配置
    ├── tailwind.config.js          # Tailwind CSS 配置
    ├── .eslintrc.json              # ESLint 配置
    └── components.json             # Shadcn 组件配置
```

## 页面路由映射

| URL 路径 | 文件位置 | 说明 | 需要认证 |
|----------|----------|------|---------|
| `/login` | `src/app/login/page.tsx` | 登录页 | 否 |
| `/` | `src/app/(protected)/page.tsx` | 首页（重定向到 /entry） | 是 |
| `/entry` | `src/app/(protected)/entry/page.tsx` | 日记条目主页 | 是 |
| `/add` | `src/app/(protected)/add/page.tsx` | 添加习惯页 | 是 |
| `/reminder` | `src/app/(protected)/reminder/page.tsx` | 提醒列表页 | 是 |
| `/reminder/add` | `src/app/(protected)/reminder/add/page.tsx` | 添加提醒页 | 是 |
| `/settings` | `src/app/(protected)/settings/page.tsx` | 设置页 | 是 |

## 关键文件说明

### 配置文件

| 文件 | 作用 |
|------|------|
| `next.config.mjs` | Next.js 配置，包含 SVG 处理、Million.js 集成 |
| `tailwind.config.js` | Tailwind 自定义颜色、屏幕断点、间距 |
| `tsconfig.json` | TypeScript 配置，路径别名 `@/*` |
| `components.json` | Shadcn UI 组件配置 |

### 核心源文件

| 文件 | 作用 | 重要程度 |
|------|------|---------|
| `src/entry/types-constants.ts` | 所有核心数据类型定义 | ⭐⭐⭐ |
| `src/atoms/index.ts` | Jotai 状态导出入口 | ⭐⭐⭐ |
| `src/atoms/databaseFirst.ts` | 混合型原子（localStorage 同步） | ⭐⭐⭐ |
| `src/hooks/useGitHubOAuth.ts` | OAuth 认证逻辑 | ⭐⭐⭐ |
| `src/api/request.ts` | Axios 实例和拦截器 | ⭐⭐ |
| `src/utils/entry.ts` | 连续记录计算等核心逻辑 | ⭐⭐ |
| `src/app/layout.tsx` | 根布局，全局 Provider | ⭐⭐ |

### 样式文件

| 文件 | 作用 |
|------|------|
| `src/styles/globals.css` | Tailwind 指令、CSS 变量、主题变量 |
| `src/styles/theme.css` | 4 个主题渐变定义 |
| `src/styles/fonts.ts` | 字体导入（Poppins + D-DIN） |
